
# استعادة قاعدة بيانات تطبيق Call

## المشكلة
بعد محاولة إضافة جدول جديد لقاعدة البيانات، حدثت أخطاء متتالية أدت إلى توقف التطبيق عن العمل بشكل صحيح.

## الحل
تم إنشاء ملف `restore_functions.sql` يحتوي على الدوال الضرورية التي يحتاجها التطبيق للعمل بشكل صحيح. هذه الدوال هي:

1. `get_user_conversations` - لجلب قائمة محادثات المستخدم
2. `get_conversation_details` - لجلب تفاصيل محادثة معينة
3. `get_conversation_messages` - لجلب رسائل محادثة معينة مع استثناء الرسائل المخفية للمستخدم الحالي

## خطوات الاستعادة

### 1. الدخول إلى لوحة تحكم Supabase
- اذهب إلى [لوحة تحكم Supabase](https://supabase.com/dashboard)
- سجل الدخول باستخدام بيانات حسابك
- اختر المشروع `xuigvkwnjnfgxxnuhnhr`

### 2. تنفيذ ملف SQL
- من القائمة الجانبية، اذهب إلى `SQL Editor`
- انقر على `New query`
- انسخ محتوى ملف `restore_functions.sql` والصقه في محرر الاستعلامات
- انقر على `Run` لتنفيذ الاستعلام

### 3. التحقق من الجداول
تأكد من أن الجداول التالية موجودة في قاعدة البيانات:
- `conversation_members`
- `conversations`
- `hidden_messages`
- `message_reads`
- `messages`
- `profiles`
- `push_tokens`
- `users`

### 4. التحقق من العلاقات بين الجداول
تأكد من أن العلاقات بين الجداول صحيحة ومطابقة للهيكل الأصلي.

### 5. تشغيل التطبيق
بعد استعادة قاعدة البيانات، قم بتشغيل التطبيق مرة أخرى:
```bash
npm start
# أو
expo start
```

## ملاحظات مهمة
- إذا كنت قد أضفت جداول جديدة وحافظت على الجداول الأصلية، فقد تحتاج إلى تعديل الكود ليتعامل مع الجداول الجديدة بشكل صحيح.
- إذا كنت قد عدلت على الجداول الأصلية، فقد تحتاج إلى استعادتها من نسخة احتياطية أو إعادة إنشائها بالهيكل الأصلي.
- احتفظ دائماً بنسخة احتياطية من قاعدة البيانات قبل إجراء أي تغييرات كبيرة.

## الدعم
إذا واجهت أي مشاكل أثناء عملية الاستعادة، يمكنك التواصل مع فريق الدعم الفني.
